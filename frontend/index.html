<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Currently active WebCompat Interventions</title>
    <script>
      document.addEventListener("DOMContentLoaded", async () => {
        try {
          const response = await fetch("/backend/interventions.json");
          if (!response.ok) {
            const message = await response.text();
            throw new Error(`Backend error: ${response.status} - ${message}`);
          }

          const data = await response.json();

          let table = document.createElement("table");
          let tableHeaderCells = ["Bugzilla Bug", "Affected domain(s)", "Type", "Target platform"].map((label) => {
            let cell = document.createElement("th");
            cell.innerText = label;
            return cell;
          });
          let tableHeaderRow = document.createElement("tr");
          tableHeaderRow.append(...tableHeaderCells);
          table.appendChild(tableHeaderRow);

          data.forEach((intervention) => {
            let row = document.createElement("tr");
            let bugzillaLinkCell = document.createElement("td");
            bugzillaLinkCell.innerHTML = `<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=${intervention.bug}">${intervention.bug}</a>`;
            let dataCells = [intervention.domain, intervention.type, intervention.platform].map((cellText) => {
              let cell = document.createElement("td");
              cell.innerText = cellText;
              return cell;
            });
            row.append(bugzillaLinkCell, ...dataCells);
            table.appendChild(row);
          });
          document.getElementById("content").replaceChildren(table);
        } catch (error) {
          document.getElementById("placeholder").innerText = error.toString();
          return;
        }
      });
    </script>
    <style>
      #content,
      p {
        margin: 25px;
      }

      table {
        border-collapse: collapse;
        width: 100%;
      }

      td,
      th {
        border: 1px solid black;
        padding: 5px 7px;
        text-align: left;
      }
    </style>
  </head>
  <body>
    <div id="content">
      <h1 id="placeholder">Loading and parsing data...</h1>
    </div>
    <p>
      Showing all interventions currently shipping in mozilla-central. (<a
        href="https://0b101010.codes/mozilla/webcompat-interventions-dashboard"
        >source</a
      >)
    </p>
  </body>
</html>
